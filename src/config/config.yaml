app_config:
  data:
    data_path: data/train.parquet
    batch_data:
      is_remote: true
      remote_data_id: 1lSKBgYQ6bgV4ARRpeRfPMpLgf1GgyWY8
      download_path: data/downloaded_data.parquet
      batch_mode: false
      batch_size: 100
    num_vars:
      - age
      - pclass
      - sibsp
      - parch
      - fare
      - survived
    cat_vars:
      - sex
      - embarked

  db:
    db_path: sqlite:///results.db
    max_connections: 5

  model:
    hyperparams:
      n_splits: 5
      n_estimators: 100
      max_depth: 10
      random_state: 42
      test_size: 0.2

    artifacts:
      model_path: models/model.pkl

  celery_config:
    task_config:
      task_serializer: json
      result_serializer: json
      timezone: UTC
      enable_utc: true
    # Task routing and queues
    task_routes:
      src.celery_pkg.tasks.email_tasks.*: { queue: email }
      src.celery_pkg.tasks.data_processing.*: { queue: data }
      src.celery_pkg.tasks.periodic_tasks.*: { queue: periodic }
      src.celery_pkg.tasks.ml_prediction_tasks.*: { queue: prediction }

    worker_config:
      worker_prefetch_multiplier: 1  # Busy workers are only assigned 1 task
      task_acks_late: true  # Acknowledge tasks after completion
      worker_max_tasks_per_child: 1000

    beat_config:
      beat_schedule:
        cleanup_old_records:
          task: src.celery_pkg.tasks.periodic_tasks.cleanup_old_records
          schedule: 3600 # 1 hour
      health_check:
        task: src.celery_pkg.tasks.periodic_tasks.health_check
        schedule: 180 # 3 minutes

    other_config:
      result_expires: 3600
      task_compression: gzip
      result_compression: gzip
      result_backend_always_retry: true
      result_persistent: true
      result_backend_max_retries: 3

  api_config:
    title: Data Processing API
    name: ${.title}
    description: API for processing large datasets
    version: v0.2.5
    status: healthy
    batch_size: 500
    prefix: /api/v1

    # Server Settings
    server:
      host: 0.0.0.0
      port: 8000
      workers: 1
      reload: false

    # Middleware Configuration
    middleware:
      cors:
        allow_origins: ["*"]
        allow_credentials: true
        allow_methods: ["*"]
        allow_headers: ["*"]
